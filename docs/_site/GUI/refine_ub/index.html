<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Spectroscopy HIstogram Visualizer for Event Reduction | a data visualization tool for single crystal neutron spectroscopy.</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Spectroscopy HIstogram Visualizer for Event Reduction" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="a data visualization tool for single crystal neutron spectroscopy." />
<meta property="og:description" content="a data visualization tool for single crystal neutron spectroscopy." />
<link rel="canonical" href="http://localhost:4000/Shiver/GUI/refine_ub/" />
<meta property="og:url" content="http://localhost:4000/Shiver/GUI/refine_ub/" />
<meta property="og:site_name" content="Spectroscopy HIstogram Visualizer for Event Reduction" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Spectroscopy HIstogram Visualizer for Event Reduction" />
<script type="application/ld+json">
{"url":"http://localhost:4000/Shiver/GUI/refine_ub/","headline":"Spectroscopy HIstogram Visualizer for Event Reduction","@type":"WebPage","description":"a data visualization tool for single crystal neutron spectroscopy.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/Shiver/assets/css/style.css?v=">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/Shiver/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">SHIVER - <u>S</u>pectroscopy <u>HI</u>stogram <u>V</u>isualizer for <u>E</u>vent <u>R</u>eduction</h1>
      
      
      
    </header>
    
    <main id="content" class="main-content" role="main">
    <a href=/Shiver/>Home</a>
      <ul id="markdown-toc">
  <li><a href="#refine-lattice-parameters-and-orientation-ub-matrix" id="markdown-toc-refine-lattice-parameters-and-orientation-ub-matrix">Refine lattice parameters and orientation (UB matrix)</a>    <ul>
      <li><a href="#suggestions" id="markdown-toc-suggestions">Suggestions</a></li>
    </ul>
  </li>
</ul>

<h1 id="refine-lattice-parameters-and-orientation-ub-matrix">Refine lattice parameters and orientation (UB matrix)</h1>

<p>Sometimes the sample orientation or the lattice parameters are incorrect. In version 1.0.0 of
Shiver we introduced an experimental way to adjust these values.</p>

<p><img src="/Shiver//images/Shiver-wrongUB.png" alt="Shiver wrong UB" /></p>

<p>Click on the event workspace and select <code class="language-python highlighter-rouge"><span class="n">Refine</span> <span class="n">sample</span> <span class="n">parameters</span></code>. The histogram
parameters will be prepopulated with some default values, to create a 3D view.</p>

<p><img src="/Shiver//images/Shiver-refineUB-parameters.png" alt="Shiver refine UB parameters" /></p>

<p>Once the histogram is created, a new tab is opened:</p>

<p><img src="/Shiver//images/Shiver-refineUB-tab.png" alt="Shiver refine UB tab" /></p>

<p>On the left hand side there is an embedded <a href="https://docs.mantidproject.org/nightly/workbench/sliceviewer.html">Mantid slice viewer</a>.
The center area is reserved for the list of peaks to be used for refinement. The right hand
side is used for plotting selected peaks and for controlling the refinement process.</p>

<p>To populate the peaks list, there are two options. The recommended procedure
is to click on <code class="language-python highlighter-rouge"><span class="n">Populate</span> <span class="n">Peaks</span></code> button. Then in the slice viewer just click on the desired
pek position. It will be marked with a red X. Do not worry if you did not clicked exactly
in the center. If possible, click on several non-coplanar peaks. If you use more peaks
you have a chance for a better refinement. An alternative way is to use <code class="language-python highlighter-rouge"><span class="n">Predict</span> <span class="n">Peaks</span></code>.
This will try to use all integer coordinates for peaks, so the list of peaks might be very long.</p>

<p>Clicking on any peak in the list will display the slices along the projection view directions:</p>

<p><img src="/Shiver//images/Shiver-refineUB-centering.png" alt="Shiver refine UB peak view" /></p>

<p>In the peaks list, select the peak you want to re-center. You can click one <code class="language-python highlighter-rouge"><span class="n">Select</span> <span class="n">All</span></code> and
manually deselect the few you donâ€™t need. Click on <code class="language-python highlighter-rouge"><span class="n">Recenter</span></code> button.</p>

<p>The alignment usually happens on Bragg peaks at integer position. For all the peaks
used in the refinement one needs to set the <code class="language-python highlighter-rouge"><span class="n">H</span></code>, <code class="language-python highlighter-rouge"><span class="n">K</span></code>, <code class="language-python highlighter-rouge"><span class="n">L</span></code> values to the expected ones. If the orientation
and lattice parameters are relatively good, one can just round these values to the neares integers.
Use the <code class="language-python highlighter-rouge"><span class="n">Round</span> <span class="n">HKL</span></code> button.</p>

<p>You are now ready for refinement. If there are peaks only in a single plane, one can easily just refine the
orientation. Use <code class="language-python highlighter-rouge"><span class="n">Refine</span> <span class="n">orientation</span> <span class="n">only</span></code> button. Otherwise, one can use the <code class="language-python highlighter-rouge"><span class="n">Refine</span></code> option. If you 
know the lattice type please use it.</p>

<p><img src="/Shiver//images/Shiver-refineUB-ready.png" alt="Shiver refine UB ready for refinement" /></p>

<p>Once you clink on the <code class="language-python highlighter-rouge"><span class="n">Refine</span></code> or <code class="language-python highlighter-rouge"><span class="n">Refine</span> <span class="n">orientation</span> <span class="n">only</span></code> buttons, Shiver will try to get a better UB
matrix, and will re-histogram the workspace.</p>

<p><img src="/Shiver//images/Shiver-refineUB-check.png" alt="Shiver refine UB refinement check" /></p>

<p>Check that everything is fine, using the Slice Viewer. If you are happy, ckick <code class="language-python highlighter-rouge"><span class="n">Close</span></code>. The new UB
matrix is attached to the MDEvent workspace. For future use, in the main window use the workspace
context menu to save the dataset with the current orientation. If you are unhappy with the results,
click <code class="language-python highlighter-rouge"><span class="n">Undo</span></code></p>

<h2 id="suggestions">Suggestions</h2>

<ul>
  <li>Be mindful of memory and speed, when creating the 3D workspace. It is advisable to limit the ranges
 of the momentum dimensions.</li>
  <li>Use linear scaling with <code class="language-python highlighter-rouge"><span class="mf">1.5</span><span class="o">-</span><span class="n">Inetrquartile</span> <span class="n">Range</span></code> for best views of Bragg peaks.</li>
  <li>It might be useful to do the refinement in steps, starting with orientation only.</li>
</ul>


      <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
