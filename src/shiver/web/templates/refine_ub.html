{% extends "base.html" %}

{% block title %}Refine UB - Shiver{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header">
        <h1>Refine UB</h1>
    </div>
    <div class="card-body">
        <form action="{{ url_for('refine_ub') }}" method="post">
            <fieldset>
                <legend>Initialize Model</legend>
                <p>Select the MDH and MDE workspaces to use for refinement.</p>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="mdh_workspace" class="form-label">MDH Workspace (Histogram)</label>
                        <select name="mdh_workspace" id="mdh_workspace" class="form-select">
                            <option value="">-- Select --</option>
                            {% for ws in hist_workspaces %}<option value="{{ ws[0] }}">{{ ws[0] }}</option>{% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="mde_workspace" class="form-label">MDE Workspace</label>
                        <select name="mde_workspace" id="mde_workspace" class="form-select">
                            <option value="">-- Select --</option>
                            {% for ws in mde_workspaces %}<option value="{{ ws[0] }}">{{ ws[0] }}</option>{% endfor %}
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Initialize</button>
            </fieldset>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header"><h2>Peaks</h2></div>
            <div class="card-body">
                <form action="{{ url_for('predict_peaks') }}" method="post" class="mb-3">
                    <button type="submit" class="btn btn-secondary">Predict Peaks</button>
                </form>
                <table class="table table-striped">
                    <thead><tr><th>H</th><th>K</th><th>L</th></tr></thead>
                    <tbody>
                        {% for peak in peaks %}
                        <tr>
                            <td>{{ "%.5f"|format(peak[0]) }}</td>
                            <td>{{ "%.5f"|format(peak[1]) }}</td>
                            <td>{{ "%.5f"|format(peak[2]) }}</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="3" class="text-center">No peaks loaded.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header"><h2>Lattice Parameters</h2></div>
            <div class="card-body">
                <form action="{{ url_for('refine_ub_action') }}" method="post">
                    <fieldset>
                        <div class="row g-3">
                            <div class="col-sm-6"><label for="a" class="form-label">a:</label><input type="text" id="a" value="{{ lattice_params.get('a', '') }}" class="form-control" readonly></div>
                            <div class="col-sm-6"><label for="alpha" class="form-label">alpha:</label><input type="text" id="alpha" value="{{ lattice_params.get('alpha', '') }}" class="form-control" readonly></div>
                            <div class="col-sm-6"><label for="b" class="form-label">b:</label><input type="text" id="b" value="{{ lattice_params.get('b', '') }}" class="form-control" readonly></div>
                            <div class="col-sm-6"><label for="beta" class="form-label">beta:</label><input type="text" id="beta" value="{{ lattice_params.get('beta', '') }}" class="form-control" readonly></div>
                            <div class="col-sm-6"><label for="c" class="form-label">c:</label><input type="text" id="c" value="{{ lattice_params.get('c', '') }}" class="form-control" readonly></div>
                            <div class="col-sm-6"><label for="gamma" class="form-label">gamma:</label><input type="text" id="gamma" value="{{ lattice_params.get('gamma', '') }}" class="form-control" readonly></div>
                        </div>
                    </fieldset>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">Refine</button>
                        <button type="submit" formaction="#" class="btn btn-secondary">Refine Orientation</button>
                        <button type="submit" formaction="#" class="btn btn-secondary">Undo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
